# История создания и причины появления exgrex-py.
---
[Почему проект назван exgrex-py?](https://github.com/vshagur/exgrex-py/blob/docs/docs/history.md#%D0%BF%D0%BE%D1%87%D0%B5%D0%BC%D1%83-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82-%D0%BD%D0%B0%D0%B7%D0%B2%D0%B0%D0%BD-exgrex-py)

[Небольшой ликбез для тех, кто не понимает о чем идет речь.](https://github.com/vshagur/exgrex-py/blob/docs/docs/history.md#%D0%B4%D0%BB%D1%8F-%D1%82%D0%B5%D1%85-%D0%BA%D1%82%D0%BE-%D0%BD%D0%B5-%D0%BF%D0%BE%D0%BD%D0%B8%D0%BC%D0%B0%D0%B5%D1%82-%D0%BE-%D1%87%D0%B5%D0%BC-%D0%B8%D0%B4%D0%B5%D1%82-%D1%80%D0%B5%D1%87%D1%8C)

[Проблематика и причины возникновения проекта.](https://github.com/vshagur/exgrex-py/blob/docs/docs/history.md#%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC%D0%B0%D1%82%D0%B8%D0%BA%D0%B0-%D0%B8-%D0%BF%D1%80%D0%B8%D1%87%D0%B8%D0%BD%D1%8B-%D0%B2%D0%BE%D0%B7%D0%BD%D0%B8%D0%BA%D0%BD%D0%BE%D0%B2%D0%B5%D0%BD%D0%B8%D1%8F-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B0)

[Первая версия exgrex](https://github.com/vshagur/exgrex-py/blob/docs/docs/history.md#%D0%BF%D0%B5%D1%80%D0%B2%D0%B0%D1%8F-%D0%B2%D0%B5%D1%80%D1%81%D0%B8%D1%8F-exgrex)

---
### Почему проект назван exgrex-py?
"exgrex" - сокращение от external grader executor, суффикс "py" указывает на область применения - грейдеры для проверки решений, написанных на языке программирования Python.  

---
### Небольшой ликбез для тех, кто не понимает о чем идет речь.
Образовательные онлайн платформы (Coursera, Stepik и другие) предоставляют встроенные возможности для проверки решений. Несмотря на разнообразие типов заданий, часто возникают ситуации, когда возможностей платформы не достаточно. Особенно это касается заданий на программирование. Причины: отсутствие необходимых библиотек или несовместимость их версий, отсутствие поддержки тестовых фреймворков на платформе, необходимость запуска служб при проведении тестирования работы учащегося и т.д. В таких случаях платформы предоставляют API для работы с внешним проверяющим сервисом, именуемым внешним грейдером (external grader). Одним из вариантов реализации внешнего грейдера является использование docker контейнеров, с реализованным внутри набором тестов. При поступлении решения docker контейнер запускается, в него передается идентификатор задания partId и файл с решением. В качестве ответа возвращается (или записывается в файл) json строка вида: 

    {'feedback':'All tests passed!', 'fractionalScore':'1'} 

содержимое которой включает итоговую оценку и комментарий к решению.

В одних случаях внешний грейдер интегрируется в инфраструктуру платформы. Например, на Coursera для интеграции с платформой вам достаточно загрузить исходные коды для сборки докер образа грейдера на платформу. В других случаях (например, на платформе Stepik), предоставляется только api платформы для получения решений студентов и отправки результатов проверки обратно на платформу, а всю инфракструктуру по обмену данными с платформой и проверкой решений необходимо реализовать и развернуть самостоятельно. 

Дополнительная информация:
- [Stepik. External grader: интеграция внешней проверяющей системы](https://stepik.org/lesson/58101/step/2?unit=35801)
- [Epic Guide to Stepik. External grader](https://stepik.org/lesson/50675/step/1)
- [coursera_autograder](https://github.com/coursera/coursera_autograder)
- [programming-assignments-demo](https://github.com/coursera/programming-assignments-demo)

---
### Проблематика и причины возникновения проекта.

При создании грейдеров преподаватели не имеют унифицированного инструмента для построения внешних грейдеров. Определено только api для работы с платформой. Внутренняя структура грейдеров не регламентируется какими-либо соглашениями. Преподаватели вольны использовать любые инструменты и способы организации кода при реализации грейдеров, либо требуется потратить часть ресурсов команды курса на создание собственных соглашений. Отсутствие единообразного подхода в реализации грейдеров в свою очередь приводит к возникновению "зоопарка", в котором грейдера каждого из преподавателей уникальны, имееют собственную структуру и реализации стандартных скриптов.

Другая проблема заключается в том, что в предложенных инструментах механизм запуска тестов и сами тесты объединены в одном коде и отсутствует возможность конфигурирования. Попытка внести изменения, при создании нового грейдера (например: добавить возможность получать в качестве файла решения zip архив), приводит к переписыванию кода "под задачу" или добавлению "костылей" в уже существующее решение.

Такое положение дел сильно увеличивает нагрузку на поддержку курса. 
- Во-первых, это повышает требования к уровню знаний у сотрудников поддержки и увеличивает время вхождения для новых сотрудников.
- Во-вторых, усложняется поиск ошибок в решениях студентов при возникновении неординарных решений и необходимости ручной проверки. Локальное использование готовых образов грейдеров не позволяет получить более подробный отчет о тестах или запустить отладчик. А поиск ошибки без использования тестов увеличивает время нахождения ошибки. В качестве решения этих проблем, приходится писать дублирующие грейдер наборы тестов. Кроме того, использование готовых образов при большом количестве поддерживаемых курсов и заданий требует наличие большого объема памяти на файловой системе. 
- В-третьих, возникают сложности при обнаружении ошибок в коде грейдеров. Необходимость связаться с автором грейдера или самостоятельно разобраться в чужом коде, чтобы внести в него несколько правок, требует дополнительного времени. Отсутствие версионирования и наличия мета информации внутри образов грейдеров (например, changelog) добавляют проблем при внесении изменений. 
- В-четвертых, невозможность использовать тестовые фреймворки "из коробки", снижает для учащихся информационную ценность сообщений об ошибках, что приводит к появлению дополнительных обращений в поддержку курса. 


Таким образом, возникла потребность в решении, которое могло предоставить преподавателям и сотрудникам поддержки инструмент, который отвечал бы следующим требованиям:
1. имел соглашение о единой структуре для всех создаваемых грейдеров
2. написание грейдера было простым и сводилось к созданию структуры грейдера по шаблону, его конфигурации и написанию тестов
3. имел возможность работать "из коробки" с тестовыми фреймворками unittest, pytest
4. имел возможность гибкой конфигурации грейдера под конкретную задачу
5. имел возможность расширения функционала, через написание собственных дополнений 
6. имел возможность локального запуска тестов без использования docker образов (для отладки самих тестов или во время проверки решений)

---
### Первая версия exgrex

```

Несколько пояснений относительно используемых далее определений
- под грейдером мы понимаем исходный код, содержащий всю необходимую информацию (файл настроек для платформы, скрипты запуска, структуру сабгрейдеров и т.д.) для сборки докер образа 
- сабгрейдер - директория с кодом, в котором хранится вся информация для запуска проверки решения по конкретному задания

```

[Первая версия exgrex](https://github.com/vshagur/exgrex) была написана "на коленке", во время ревизии уже действующих курсов. 

По этой причине она имела определенную "заточенность" на решение наших собственных текущих задач и, как следствие, ряд недостатков:
- из-за необходимости работы на нескольких образовательных платформах и особенностей реализации собственной инфраструктуры было установлено правило "один docker образ - одно задание". По этой причине версия не поддерживает объединение нескольких сабгрейдеров в один грейдер и все настройки выполняются непосредственно внутри сабгрейдера. 
- в выборе тестового фреймворка предпочтение было отдано pytest, поэтому пакет exgrex имеет его в качестве зависимости
- работа с фреймворком pytest реализована через сохранение результатов тестирования в xml файле с последующим парсингом
- основной скрипт запуска написан на Python
- не весь необходимый функционал был реализован, например: при конфигурирование нет возможность установить порог прохождения тестов (для получения зачета по заданию всегда требуется полное прохождение 100% тестов)


Тем не менее, данное решение оказалось вполне работоспособным (грейдера, созданные на базе этого пакета до сих пор отлично справляются со своей задачей).
В процессе использования были выявлен еще один недостаток. В грейдерах со сложной структурой (например, в заданиях по Django) возникли проблемы с запусками тестов при использовании стандартного подхода по созданию грейдеров. Внесение изменений, приводило к переписыванию основного скрипта - действию, от которого мы хотели избавиться прежде всего при создании данного инструмента.

Возникли новые идеи и мысли по развитию данного проекта:
- убрать из зависимостей pytest (во многих случаях достаточно unittest, подключение pytest можно реализовать как плагин или отдельный пакет)
- в качестве языка программирования для основного скрипта использовать shell или bash (такая универсальность поможет использовать скрипты запуска в других курсах, например по с++ или js)
- реализовать функционал объединения нескольких сабгрейдеров в одном грейдере (в некоторых случаях применение подхода - "один docker образ - одно задание" может быть избыточным, например: при реализации грейдера только для Coursera)
- общие настройки (специфичные для платформы) должны быть вынесены из настроек сабгрейдеров
- запуск тестов должен быть вынесен на отдельный уровень с возможностью конфигурации команды запуска
- реализация обработки результатов тестирования должна быть реализована с помощью возможностей по кастомизации самих тестовых фреймворков (для pytest - использование hooks, для unittest - переопределение методов базовых классов)
- добавить функционал необходимый для реализации грейдеров со сложной структурой
- реализовать функционал, позволяющий устанавливать порог прохождения 

Как это бывает в жизни, реализация данных идей откладывалась "на потом" под разными предлогами, начиная от дежурного - "времени нет" и заканчивая успокоительным - "работает, не трогай". Так продолжалось до ноября 2020 года, когда Coursera объявила об изменении API. Начиная с этого момента любое внесение правок в уже существующие грейдера и создание новых на основе существующей версии exgrex стало не возможным. 

---


