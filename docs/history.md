# история создания exgrex-py

#### Почему проект назван exgrex-py?
"exgrex" - сокращение от external grader executor, суффикс "py" указывает на область применения - курсы по изучению языка программирования Python.  

#### Для тех кто не понимает о чем идет речь.
Образовательные онлайн платформы (Coursera, Stepik и другие) предоставляют встроенные возможности для проверки решений. Несмотря на разнообразие типов заданий, часто возникают ситуации, когда возможностей платформы не достаточно. Особенно это касается заданий на программирование. Причины: отсутствие необходимых библиотек или несовместимость их версий, отсутствие поддержки тестовых фреймворков на платформе, необходимость запуска служб при проведении тестирования работы учащегося и т.д. В таких случаях платформы предоставляют API для работы с внешним проверяющим сервисом, именуемым внешним грейдером (external grader). Одним из вариантов реализации внешнего грейдера является использование docker контейнеров, с реализованным внутри набором тестов. При поступлении решения docker контейнер запускается, в него передается идентификатор задания partId и файл с решением. В качестве ответа возвращается (или записывается в файл) json строка вида: 

    {'feedback':'All tests passed!', 'fractionalScore':'1'} 

содержимое которой включает итоговую оценку и комментарий к решению.

В одних случаях внешний грейдер интегрируется в инфраструктуру платформы, например на Coursera, и для интеграции с платформой вам достаточно загрузить исходные коды для сборки докер образа грейдера на платформу. В других, например на платформе Stepik, предоставляется только api платформы для получения решений студентов и отправки результатов проверки обратно на платформу, а всю инфракструктуру по обмену данными с платформой и проверкой решений необходимо реализовать и развернуть самостоятельно. 

Дополнительная информация:
- [Stepik. External grader: интеграция внешней проверяющей системы](https://stepik.org/lesson/58101/step/2?unit=35801)
- [Epic Guide to Stepik. External grader](https://stepik.org/lesson/50675/step/1)
- [coursera_autograder](https://github.com/coursera/coursera_autograder)
- [programming-assignments-demo](https://github.com/coursera/programming-assignments-demo)


### Проблематика и причины возникновения проекта.

Проблемы при создании курса:
отсутствие единого формата для 
- несколько преподавателей, каждый пишет свой велик (набор скриптов для запуска) или задания требуют различных видов тестирования (интеграционного, модульного)
- вход новых сотрудников осложняется тем, что приходится вникать 
- сложности с локальной проверкой из-за зоопарка, что приводит к написанию дублирующих тестов
- сложности с внесением изменений, необходимо связаться с автором или разбираться кодом самостоятельно
- использование докер контейнеров при локальной проверке решение - занимает память, снижает скорость проверки
- нет встроенной возможности использовать фрейморки unittest, pytest
- отстутсвие конфигурации - необходимо писать каждый раз новый скрипт, внесение исправлений тяжело
- сложность с версионированием, отсутствие мета информации о грейдера внутри образов
- недостаточно информционный вывод, отсутствие возможности настроить выводимую информацию в сообщении об ошибке
- повышенные требовния к сотрудникам поддержки, так как им нужно знать различные фреймворки, shell, чтобы разобраться в коде грейдеров

При создании грейдеров преподаватели не имеют унифицированного инструмента для построения внешних грейдеров. Определено только api для работы с платформой. Внутренняя структура грейдеров не регламентируется какими-либо соглашениями. Преподаватели вольны использовать любые инструменты и способы организации кода при реализации грейдеров. Это в свою очередь приводит к возникновению "зоопарка", в котором грейдера каждого из преподавателей уникальны, имееют собственную структуру, скрипты. Такое положение сильно нагружает поддержку курса в дальнейшем. При возникновении не тривиальных ошибок в решениях студентов, разбор механизма проверок в том или ином грейдере может занимать длительное время. 

Другой проблемой является объединение в одном коде механизмов запуска тестов и самих тестов, а также отсутствие возможности конфигурации. Попытки внести изменения, при создании нового грейдера (например: добавить возможность получать в качестве файла решения zip архив), приводило к переписыванию кода "под задачу" или добавлению "костылей". 

Таким образом возникла потребность в решении, которое могло предоставить преподавателям инструмент, который отвечал бы следующим требованиям:
1. имел соглашение о единой структуре для всех создаваемых грейдеров
2. написание грейдера было простым и сводилось к созданию структуры грейдера, конфигурации и написанию тестов
3. предоставлялась возможность работать "из коробки" с тестовым фреймворком
4. наличие возможности гибкой конфигурации грейдера под конкретную задачу
5. имел возможность расширения функционала, через написание собственных дополнений 
6. имел возможность локального запуска тестов (для отладки самих тестов во время их написания)


#### Первая версия exgrex

Еще несколько замечаний относительно используемых далее определений
- под грейдером мы понимаем исходный код, содержащий всю необходимую информацию (файл настроек для платформы, скрипты запуска, структуру сабгрейдеров и т.д.) для сборки докер образа 
- сабгрейдер - директория с кодом, в котором хранится вся информация для запуска проверки решения по конкретному задания
Пример:

[Первая версия exgrex](https://github.com/vshagur/exgrex) была написана "на коленке", во время ревизии уже действующих курсов. Несмотря на костыльность и наличие некоторых проблем, данное решение оказалось вполне работоспособным (грейдера, созданные на базе этого пакета до сих пор отлично справляются со своей задачей). В процессе применения выявились несколько проблем. 
- один образ - одна задача, нет реализована поддержка нескольких задач в одном образе
- конфигурация только сабгрейдера
- основные проверки реализованы в сабгрейдере (часть проверок используется абсолютно во всех сабгрейдерах и может быть вынесена в основной скрипт)
- основной скрипт запуска написан на python (использование shell или bash позволило бы использовать его при создании пакетов для других языков программирования, например: с++, js)
- нет возможности организовывать более сложную структуру сабгрейдера, например для заданий по django
- зависимость от pytest, лучше сделать его подключаемым через плагин или отдельный пакет
- использование сохранение результатов тестов в xml файле и дальнейшего его парсинга для получение результата, при наличии возможностей фреймворков по кастомизации
- пробелемы с архитектурой проекта, сложности с модификацией кода 

Анализ этих проблем привел к мысли, что необходимо полностью переписать данный проект. Как это бывает в жизни, реализация данной идеи откладывалась "на потом" под разными предлогами, начиная от дежурного - "времени нет" и заканчивая успокоительным - "работает, не трогай". Так продолжалось до ноября 2020 года, когда Coursera объявила об измении api. Любое внесение правок в уже существующие грейдера и создание новых на основе существующей версии exgrex стало не возможным. 




