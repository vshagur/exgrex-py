# История создания и причины появления exgrex-py.

[Почему проект назван exgrex-py?](https://github.com/vshagur/exgrex-py/blob/docs/docs/history.md#%D0%BF%D0%BE%D1%87%D0%B5%D0%BC%D1%83-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82-%D0%BD%D0%B0%D0%B7%D0%B2%D0%B0%D0%BD-exgrex-py)

[Для тех кто не понимает о чем идет речь.](https://github.com/vshagur/exgrex-py/blob/docs/docs/history.md#%D0%B4%D0%BB%D1%8F-%D1%82%D0%B5%D1%85-%D0%BA%D1%82%D0%BE-%D0%BD%D0%B5-%D0%BF%D0%BE%D0%BD%D0%B8%D0%BC%D0%B0%D0%B5%D1%82-%D0%BE-%D1%87%D0%B5%D0%BC-%D0%B8%D0%B4%D0%B5%D1%82-%D1%80%D0%B5%D1%87%D1%8C)

[Проблематика и причины возникновения проекта.](https://github.com/vshagur/exgrex-py/blob/docs/docs/history.md#%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC%D0%B0%D1%82%D0%B8%D0%BA%D0%B0-%D0%B8-%D0%BF%D1%80%D0%B8%D1%87%D0%B8%D0%BD%D1%8B-%D0%B2%D0%BE%D0%B7%D0%BD%D0%B8%D0%BA%D0%BD%D0%BE%D0%B2%D0%B5%D0%BD%D0%B8%D1%8F-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B0)

[Первая версия exgrex](https://github.com/vshagur/exgrex-py/blob/docs/docs/history.md#%D0%BF%D0%B5%D1%80%D0%B2%D0%B0%D1%8F-%D0%B2%D0%B5%D1%80%D1%81%D0%B8%D1%8F-exgrex)


#### Почему проект назван exgrex-py?
"exgrex" - сокращение от external grader executor, суффикс "py" указывает на область применения - курсы по изучению языка программирования Python.  

#### Для тех, кто не понимает о чем идет речь.
Образовательные онлайн платформы (Coursera, Stepik и другие) предоставляют встроенные возможности для проверки решений. Несмотря на разнообразие типов заданий, часто возникают ситуации, когда возможностей платформы не достаточно. Особенно это касается заданий на программирование. Причины: отсутствие необходимых библиотек или несовместимость их версий, отсутствие поддержки тестовых фреймворков на платформе, необходимость запуска служб при проведении тестирования работы учащегося и т.д. В таких случаях платформы предоставляют API для работы с внешним проверяющим сервисом, именуемым внешним грейдером (external grader). Одним из вариантов реализации внешнего грейдера является использование docker контейнеров, с реализованным внутри набором тестов. При поступлении решения docker контейнер запускается, в него передается идентификатор задания partId и файл с решением. В качестве ответа возвращается (или записывается в файл) json строка вида: 

    {'feedback':'All tests passed!', 'fractionalScore':'1'} 

содержимое которой включает итоговую оценку и комментарий к решению.

В одних случаях внешний грейдер интегрируется в инфраструктуру платформы, например на Coursera, и для интеграции с платформой вам достаточно загрузить исходные коды для сборки докер образа грейдера на платформу. В других, например на платформе Stepik, предоставляется только api платформы для получения решений студентов и отправки результатов проверки обратно на платформу, а всю инфракструктуру по обмену данными с платформой и проверкой решений необходимо реализовать и развернуть самостоятельно. 

Дополнительная информация:
- [Stepik. External grader: интеграция внешней проверяющей системы](https://stepik.org/lesson/58101/step/2?unit=35801)
- [Epic Guide to Stepik. External grader](https://stepik.org/lesson/50675/step/1)
- [coursera_autograder](https://github.com/coursera/coursera_autograder)
- [programming-assignments-demo](https://github.com/coursera/programming-assignments-demo)


### Проблематика и причины возникновения проекта.

При создании грейдеров преподаватели не имеют унифицированного инструмента для построения внешних грейдеров. Определено только api для работы с платформой. Внутренняя структура грейдеров не регламентируется какими-либо соглашениями. Преподаватели вольны использовать любые инструменты и способы организации кода при реализации грейдеров, либо требуется потратить часть ресурсов на создание собственных соглашений. Отсутствие единообразного подхода в реализации грейдеров в свою очередь приводит к возникновению "зоопарка", в котором грейдера каждого из преподавателей уникальны, имееют собственную структуру и реализации стандартных скриптов.

Другая проблема заключалась в том, что в предложенных инструментах механизм запуска тестов и сами тесты были объединение в одном коде и отсутствовала возможности конфигурации. Попытки внести изменения, при создании нового грейдера (например: добавить возможность получать в качестве файла решения zip архив), приводили к переписыванию кода "под задачу" или добавлению "костылей".

Такое положение дел сильно увеличивает нагрузку на поддержку курса. 
- Во-первых, это повышает требования к уровню знаний у сотрудников поддержки и увеличивает время вхождения для новых сотрудников.
- Во-вторых, усложняется поиск ошибок в решениях студентов при возникновении неординарных решений и необходимости ручной проверки. Локальное использование готовых образов грейдеров не позволяет получить более подробный отчет о тестах или запустить отладчик. А поиск ошибки без использования тестов увеличивает время нахождения ошибки. В качестве решения этих проблем, приходится писать дублирующие грейдер наборы тестов. Кроме того, использование готовых образов при большом количестве поддерживаемых курсов и заданий требует наличие большого объема памяти на файловой системе. 
- В-третьих, возникают сложности при обнаружении ошибок в коде грейдеров. Необходимость связаться с автором грейдера или самостоятельно разобраться в чужом коде, чтобы внести в него несколько правок, требует дополнительного времени. Отсутствие версионирования и наличия мета информации внутри образов грейдеров (например, changelog) добавляют проблем при внесении изменений. 
- В-четвертых, невозможность использовать фреймворки "из коробки", снижают для учащихся информационную значимость сообщений об ошибках, что приводит к появлению дополнительных обращений в поддержку курса. 


Таким образом, возникла потребность в решении, которое могло предоставить преподавателям и сотрудникам поддержки инструмент, который отвечал бы следующим требованиям:
1. имел соглашение о единой структуре для всех создаваемых грейдеров
2. написание грейдера было простым и сводилось к созданию структуры грейдера, конфигурации и написанию тестов
3. предоставлялась возможность работать "из коробки" с тестовыми фреймворками
4. наличие возможности гибкой конфигурации грейдера под конкретную задачу
5. имел возможность расширения функционала, через написание собственных дополнений 
6. имел возможность локального запуска тестов (для отладки самих тестов во время их написания)


#### Первая версия exgrex

Еще несколько замечаний относительно используемых далее определений
- под грейдером мы понимаем исходный код, содержащий всю необходимую информацию (файл настроек для платформы, скрипты запуска, структуру сабгрейдеров и т.д.) для сборки докер образа 
- сабгрейдер - директория с кодом, в котором хранится вся информация для запуска проверки решения по конкретному задания
Пример:

[Первая версия exgrex](https://github.com/vshagur/exgrex) была написана "на коленке", во время ревизии уже действующих курсов. Несмотря на костыльность и наличие некоторых проблем, данное решение оказалось вполне работоспособным (грейдера, созданные на базе этого пакета до сих пор отлично справляются со своей задачей). В процессе применения выявились несколько проблем. 
- один образ - одна задача, нет реализована поддержка нескольких задач в одном образе
- конфигурация только сабгрейдера
- основные проверки реализованы в сабгрейдере (часть проверок используется абсолютно во всех сабгрейдерах и может быть вынесена в основной скрипт)
- основной скрипт запуска написан на python (использование shell или bash позволило бы использовать его при создании пакетов для других языков программирования, например: с++, js)
- нет возможности организовывать более сложную структуру сабгрейдера, например для заданий по django
- зависимость от pytest, лучше сделать его подключаемым через плагин или отдельный пакет
- использование сохранение результатов тестов в xml файле и дальнейшего его парсинга для получение результата, при наличии возможностей фреймворков по кастомизации
- проблемы с архитектурой проекта, сложности с модификацией кода 
- нет возможноти установить порог прохждения тестов

Анализ этих проблем привел к мысли, что необходимо полностью переписать данный проект. Как это бывает в жизни, реализация данной идеи откладывалась "на потом" под разными предлогами, начиная от дежурного - "времени нет" и заканчивая успокоительным - "работает, не трогай". Так продолжалось до ноября 2020 года, когда Coursera объявила об измении api. Любое внесение правок в уже существующие грейдера и создание новых на основе существующей версии exgrex стало не возможным. 




